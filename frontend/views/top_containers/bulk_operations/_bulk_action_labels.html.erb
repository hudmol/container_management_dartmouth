<%
  columns = 4
  rows = 6
  column_width = "2.25in"
  row_height = "4.25in"
  page_break = "1in" # not implemented
%>

<html>
  <head>
    <title><%= I18n.t("top_container._frontend.bulk_operations.label_page_title") %></title>
    <link href="<%= "#{AppConfig[:frontend_prefix]}assets/container_labels.css" %>" media="all" rel="stylesheet" type="text/css"/>
    <script src="<%= "#{AppConfig[:frontend_prefix]}assets/jquery.js?body=1" %>" type="text/javascript"></script>
    <script src="<%= "#{AppConfig[:frontend_prefix]}assets/jquery-barcode.min.js" %>"></script>
    <script src="<%= "#{AppConfig[:frontend_prefix]}assets/generate_barcodes.js" %>"></script>
  </head>

<body>
  <div id="labels_to_print" class="label-sheet">

    <% columns.times do %>
      <div class="label-sheet-cell" style="width: <%= column_width %>; height: 0px;"></div>
    <% end %>

    <% labels.each_slice(columns) do |label_row| %>

      <div class="label-sheet-row">
        <% label_row.each do |label| %>
          <% 
            loc = label['container_locations'].select { |cl| cl['status'] == 'current' }.first
            loc = loc ? loc['_resolved'] : {}
            loc = loc.empty? ? '--' : ['building', 'floor', 'room', 'area'].map {|fld| loc[fld]}.compact.join(', ')
            resource = label['collection'].empty? ? {} : label['collection'].first
            series = label['series'].empty? ? {} : label['series'].first
            series = series.empty? ? "" : series['display_string'][0,50]
            archival_record = label['linked_records'].empty? ? {} : label['linked_records'].first
            date = archival_record['dates'].empty? ? {} : archival_record['dates'].first
            note = archival_record['notes'].empty? ? {} : archival_record['notes'].select{|n| n['type'] == 'scopecontent'}.first
            note = note.empty? ? "" : note['subnotes'].first['content'][0,75]
          %>

          <div class="label-sheet-cell" style="height: <%= row_height  %>">
            <div class="box-label">
              <div class="label-location-header">Box Location</div>
              <div class="label-location"><%= loc %></div>
              <div class="label-divider"></div>
              <div class="label-resource-id"><%= resource['identifier'] %></div>
              <div class="label-indicator"><%= label['indicator'] %></div>
              <div class="label-resource-title"><%= resource['display_string'] %></div>
              <div class="label-series-title"><%= series %></div>
              <div class="label-divider"></div>
              <div class="label-description"><%= note  %></div>
              <div class="label-date">
                <%= date['expression'] ? date['expression'] : [date['begin'], date['end']].compact.join(' - ')  %>
              </div>
              <div class="label-barcode" data="<%= label['barcode'] %>"></div>
            </div>
          </div>
        <% end %>
      </div>

    <% end %>

  </div>

  <div>
    <%# labels.inspect %>
  </div>

</body>
</html>
